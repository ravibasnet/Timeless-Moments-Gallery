{% load static %}

<div class="testimonial-card group relative bg-white rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 ease-out transform hover:-translate-y-2 hover:scale-[1.02] flex flex-col border border-gray-100 mx-auto w-full max-w-sm h-auto min-h-[420px]">
    <!-- Gradient Background Overlay -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary-50/50 via-transparent to-secondary/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
    
    <!-- Decorative Elements -->
    <div class="absolute -top-4 -right-4 w-24 h-24 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full opacity-10 group-hover:opacity-20 group-hover:scale-110 transition-all duration-700 ease-out"></div>
    <div class="absolute -bottom-6 -left-6 w-20 h-20 bg-gradient-to-br from-secondary to-accent rounded-full opacity-10 group-hover:opacity-20 group-hover:scale-110 transition-all duration-700 ease-out"></div>
    
    <!-- Quote Icon -->
    <div class="absolute top-6 left-6 text-primary-200 group-hover:text-primary-300 transition-colors duration-300">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h4v10h-10z"/>
        </svg>
    </div>
    
    <!-- Content Container -->
    <div class="relative z-10 p-6 flex flex-col h-full">
        <!-- Client Info Section -->
        <div class="flex items-center space-x-4 mb-6">
            <!-- Profile Image with Enhanced Styling -->
            <div class="relative flex-shrink-0">
                {% if testimonial.client_photo %}
                    <div class="w-16 h-16 rounded-full p-0.5 bg-gradient-to-br from-primary-500 via-primary-400 to-secondary ring-4 ring-white shadow-xl overflow-hidden group-hover:ring-primary-100 transition-all duration-300">
                        <img src="{{ testimonial.client_photo.url }}" 
                             alt="{{ testimonial.client_name }}"
                             class="w-full h-full rounded-full object-cover border-2 border-white">
                    </div>
                {% else %}
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-gray-100 via-gray-50 to-gray-200 flex items-center justify-center ring-4 ring-white shadow-xl group-hover:ring-primary-100 transition-all duration-300">
                        <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                {% endif %}
                
                <!-- Service Badge with Animation -->
                <div class="absolute -bottom-1 -right-1 bg-gradient-to-r from-primary-500 to-primary-600 text-white text-xs rounded-full w-7 h-7 flex items-center justify-center border-3 border-white shadow-lg transform group-hover:scale-110 transition-transform duration-300">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
            
            <!-- Client Details -->
            <div class="flex-1 min-w-0">
                <h4 class="text-lg font-bold text-gray-900 truncate group-hover:text-primary-700 transition-colors duration-300">
                    {{ testimonial.client_name }}
                </h4>
                {% if testimonial.client_role %}
                    <p class="text-sm text-gray-600 truncate flex items-center mt-1">
                        <span class="inline-block w-2 h-2 rounded-full bg-primary-400 mr-2 opacity-75 group-hover:opacity-100 transition-opacity duration-300"></span>
                        {{ testimonial.client_role }}
                    </p>
                {% endif %}
            </div>
        </div>
        
        <!-- Enhanced Rating Section -->
        <div class="mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-1">
                    {% for i in "12345"|make_list %}
                        <svg class="w-5 h-5 star-icon {% if forloop.counter <= testimonial.rating %}text-yellow-400{% else %}text-gray-200{% endif %} transform transition-transform duration-300" 
                             style="transition-delay: {{ forloop.counter }}0ms"
                             fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    {% endfor %}
                </div>
                <span class="text-sm font-semibold text-gray-700 bg-gray-100 group-hover:bg-primary-50 group-hover:text-primary-700 px-3 py-1 rounded-full transition-all duration-300">
                    {{ testimonial.rating }}.0
                </span>
            </div>
        </div>
        
        <!-- Testimonial Content with Better Typography and Multiline Support -->
        <div class="flex-grow mb-6 relative">
            <div class="relative">
                <div class="text-gray-700 leading-relaxed text-base font-medium italic group-hover:text-gray-800 transition-colors duration-300">
                    {{ testimonial.content|truncatewords:35|linebreaksbr|safe }}
                </div>
            </div>
        </div>
        
        <!-- Enhanced Footer -->
        <div class="mt-auto pt-4 border-t border-gray-100 group-hover:border-primary-100 transition-colors duration-300">
            <div class="flex justify-between items-center">
                <span class="text-xs text-gray-500 flex items-center group-hover:text-gray-600 transition-colors duration-300">
                    <svg class="w-4 h-4 mr-1 text-primary-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    {{ testimonial.created_at|date:"M Y" }}
                </span>
                <a href="{% url 'testimonials:testimonial_detail' testimonial.pk %}" 
                   class="inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 bg-primary-50 hover:bg-primary-100 px-3 py-1.5 rounded-full transition-all duration-300 group-link transform hover:scale-110 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-200">
                    Read more
                    <svg class="w-4 h-4 ml-1 transition-transform duration-300" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Hover Glow Effect -->
    <div class="absolute inset-0 rounded-3xl bg-gradient-to-r from-primary-400/20 to-secondary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
</div>

<!-- Additional CSS for line-clamp utility -->
<style>
.line-clamp-4 {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.testimonial-card {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.testimonial-card:hover {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(79, 70, 229, 0.1), 0 0 30px rgba(79, 70, 229, 0.1);
    animation: float 3s ease-in-out infinite;
}

/* Enhanced animations */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
}

/* Smooth transitions for all interactive elements */
.testimonial-card * {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Subtle background pattern */
.testimonial-card::before {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="2" fill="%23e0e7ef" fill-opacity="0.15"/></svg>');
    opacity: 0.25;
    pointer-events: none;
    z-index: 0;
}

/* Avatar ring animation */
.testimonial-card .w-16.h-16.rounded-full {
    transition: box-shadow 0.4s, border-color 0.4s;
}
.testimonial-card:hover .w-16.h-16.rounded-full {
    box-shadow: 0 0 0 4px #6366f1, 0 8px 32px rgba(99,102,241,0.10);
    border-color: #6366f1;
}

/* Star pop animation */
.star-icon {
    transition: transform 0.2s cubic-bezier(0.4,0,0.2,1), color 0.2s;
}
.testimonial-card:hover .star-icon {
    transform: scale(1.25) rotate(-8deg);
    filter: drop-shadow(0 2px 6px #fde68a88);
}

/* Read more button improvement */
.group-link:hover {
    box-shadow: 0 4px 16px rgba(99,102,241,0.18);
    background: linear-gradient(90deg, #f1f5f9 60%, #e0e7ef 100%);
    text-decoration: underline;
}

/* Multiline testimonial content */
pre.whitespace-pre-line {
    white-space: pre-line;
    background: none;
    border: 0;
    font-family: inherit;
    margin: 0;
    padding: 0;
}
</style>

